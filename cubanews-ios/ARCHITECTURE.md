# Sign in with Apple - Architecture Overview

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                         Cubanews iOS App                             โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                         App Initialization                           โ
โ                     (cubanews_iosApp.swift)                         โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                                      โ
โ  1. Initialize ModelContainer (SavedItem, UserPreferences, User)    โ
โ  2. Initialize AuthenticationManager with ModelContext              โ
โ  3. AuthenticationManager loads existing User from SwiftData        โ
โ  4. Set isAuthenticated based on loaded user                        โ
โ                                                                      โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ  โ if isAuthenticated โ ContentView                             โ  โ
โ  โ else โ LoginView                                             โ  โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                              โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                          LoginView.swift                             โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                                      โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ  โ  SignInWithAppleButton (Native iOS Component)                โ  โ
โ  โ  - Requests: [.email, .fullName]                             โ  โ
โ  โ  - onCompletion: handleSignInWithApple()                     โ  โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ                                                                      โ
โ  User Authentication Flow:                                          โ
โ  1. User taps button                                                โ
โ  2. Apple's authentication UI appears                               โ
โ  3. User authenticates (Face ID/Touch ID/Password)                  โ
โ  4. User chooses email sharing preference                           โ
โ  5. Credentials returned to app                                     โ
โ                                                                      โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                              โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                   AuthenticationManager.swift                        โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                                      โ
โ  @Published var currentUser: User?                                  โ
โ  @Published var isAuthenticated: Bool                               โ
โ                                                                      โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ  โ handleSignInWithApple()                                      โ  โ
โ  โ  1. Extract user ID, email, name from credentials            โ  โ
โ  โ  2. Check if user exists in SwiftData                        โ  โ
โ  โ  3. If exists: Update lastLoginAt                            โ  โ
โ  โ     If new: Create User and insert to SwiftData              โ  โ
โ  โ  4. Save to SwiftData                                        โ  โ
โ  โ  5. Set currentUser and isAuthenticated = true               โ  โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ                                                                      โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ  โ signOut()                                                    โ  โ
โ  โ  1. Delete user from SwiftData                               โ  โ
โ  โ  2. Set currentUser = nil, isAuthenticated = false           โ  โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ                                                                      โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ  โ deleteAccount()                                              โ  โ
โ  โ  1. Delete user from SwiftData                               โ  โ
โ  โ  2. Set currentUser = nil, isAuthenticated = false           โ  โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ                                                                      โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                              โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                          User.swift                                  โ
โ                      (SwiftData Model)                               โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                                      โ
โ  @Model final class User {                                          โ
โ    @Attribute(.unique) var id: String       // Apple user ID        โ
โ    var email: String?                       // Can be relay         โ
โ    var fullName: String?                    // Full name            โ
โ    var givenName: String?                   // First name           โ
โ    var familyName: String?                  // Last name            โ
โ    var identityToken: String?               // JWT token            โ
โ    var authorizationCode: String?           // Auth code            โ
โ    var createdAt: Date                      // Account created      โ
โ    var lastLoginAt: Date                    // Last login time      โ
โ                                                                      โ
โ    var displayName: String { ... }          // Computed property    โ
โ  }                                                                   โ
โ                                                                      โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                              โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                      SwiftData Persistence                           โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                                      โ
โ  ModelContainer                                                      โ
โ   โโโ SavedItem (existing)                                          โ
โ   โโโ UserPreferences (existing)                                    โ
โ   โโโ User (new)                                                    โ
โ                                                                      โ
โ  Storage Location: App's Documents directory                        โ
โ  Automatic persistence across app launches                          โ
โ  Encrypted by iOS when device is locked                             โ
โ                                                                      โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                              โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                        ProfileView.swift                             โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                                      โ
โ  @EnvironmentObject var authManager: AuthenticationManager          โ
โ                                                                      โ
โ  Display:                                                            โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ  โ  ๐ค [User Icon]                                              โ  โ
โ  โ  Name: authManager.currentUser?.displayName                  โ  โ
โ  โ  Email: authManager.currentUser?.email                       โ  โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ                                                                      โ
โ  Actions:                                                            โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ  โ  [Cerrar Sesiรณn] โ authManager.signOut()                     โ  โ
โ  โ  [Eliminar Cuenta] โ authManager.deleteAccount()             โ  โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ                                                                      โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ


โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                           USER FLOWS
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Flow 1: First-Time Sign In                                          โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                                      โ
โ  1. App launches โ No user in SwiftData                             โ
โ  2. Shows LoginView                                                 โ
โ  3. User taps "Sign in with Apple"                                  โ
โ  4. Apple authentication UI                                         โ
โ  5. User authenticates with Face ID/Touch ID                        โ
โ  6. User chooses email sharing (real or hide)                       โ
โ  7. Credentials returned to app                                     โ
โ  8. AuthenticationManager creates User                              โ
โ  9. User saved to SwiftData                                         โ
โ  10. isAuthenticated = true                                         โ
โ  11. App shows ContentView                                          โ
โ                                                                      โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Flow 2: Subsequent App Launch                                       โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                                      โ
โ  1. App launches                                                    โ
โ  2. AuthenticationManager.loadCurrentUser()                         โ
โ  3. Finds User in SwiftData                                         โ
โ  4. Sets currentUser and isAuthenticated = true                     โ
โ  5. App directly shows ContentView                                  โ
โ  6. User name/email displayed in ProfileView                        โ
โ                                                                      โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Flow 3: Sign Out                                                    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                                      โ
โ  1. User in ProfileView                                             โ
โ  2. Taps "Cerrar Sesiรณn" button                                     โ
โ  3. authManager.signOut() called                                    โ
โ  4. User deleted from SwiftData                                     โ
โ  5. currentUser = nil, isAuthenticated = false                      โ
โ  6. App returns to LoginView                                        โ
โ                                                                      โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Flow 4: Delete Account                                              โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                                      โ
โ  1. User in ProfileView                                             โ
โ  2. Taps "Eliminar Cuenta" button                                   โ
โ  3. Confirmation alert appears                                      โ
โ  4. User confirms deletion                                          โ
โ  5. authManager.deleteAccount() called                              โ
โ  6. User deleted from SwiftData                                     โ
โ  7. currentUser = nil, isAuthenticated = false                      โ
โ  8. App returns to LoginView                                        โ
โ                                                                      โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ


โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                        CONFIGURATION POINTS
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

Apple Developer Portal:
  โโโ App ID: [YOUR_BUNDLE_ID]
  โโโ Team ID: [YOUR_TEAM_ID]
  โโโ Capability: Sign in with Apple (enabled)

Xcode Project:
  โโโ Signing & Capabilities
  โ   โโโ Sign in with Apple capability added
  โ   โโโ Team: [YOUR_TEAM_ID]
  โ   โโโ Bundle Identifier: [YOUR_BUNDLE_ID]
  โโโ Entitlements file (auto-generated)

Testing:
  โโโ Device/Simulator signed into Apple ID
  โโโ Internet connection required
  โโโ Test on physical device for production


โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                          DATA PRIVACY
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

โ Email can be hidden (Apple provides relay email)
โ All data stored locally (no cloud sync)
โ SwiftData encrypted by iOS
โ No tracking or analytics on auth
โ User controls data deletion
โ Complies with Apple's privacy requirements
โ GDPR compliant


โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                       FILES STRUCTURE
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

cubanews-ios/
โโโ cubanews-ios/
โ   โโโ User.swift                        โ User model
โ   โโโ AuthenticationManager.swift       โ Auth logic
โ   โโโ LoginView.swift                   โ Login UI
โ   โโโ ProfileView.swift                 โ Profile UI
โ   โโโ cubanews_iosApp.swift            โ App entry
โโโ APPLE_SIGNIN_CONFIGURATION.md         โ Full config guide
โโโ IMPLEMENTATION_SUMMARY.md             โ Technical details
โโโ QUICK_START.md                        โ Quick reference
โโโ ARCHITECTURE.md                       โ This file
```
